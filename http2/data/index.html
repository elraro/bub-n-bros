<html>
<head><title>The Bub's Brothers</title>
</head>
<body text="#000000" bgcolor="#FFFFFF" link="#0000EE" vlink="#000099" alink="#FF0000">
&nbsp;
<center><table cellspacing=0 cellpadding=0 border=0 width="95%%">


%(
externaltarget = running and ' target="new"' or ''
def showlist(tag, text, bgcolor1, bgcolor2, bubimg, servers, action, btntext,
             **hidden):
    found = []
    def show((addr, (info, ping)), found=found):
        import socket
        infolst = info.split(':') or ['?']
        if len(infolst) >= 3:
            httpport = infolst.pop(2)
        else:
            httpport = 'off'
        print '<a href="join.html?host=%s&port=%d&httpport=%s">' % (
            addr[0], addr[1], httpport)
        host, port = addr
        #host = socket.gethostbyaddr(host)[0]
        if ping is not None:
            infolst.append('ping: %dms' % int(ping*1000))
        if (addr, infolst[0]) == running:
            infolst.append('this is your own server')
            found.append(1)
        infolst = map(htmlquote, infolst)
        print '<strong>%s:%s</strong></a> playing <strong>%s</strong>' % (
            host, port, infolst[0])
        if len(infolst) > 1:
            print '&nbsp;(%s)' % ' &middot; &middot; '.join(infolst[1:])

    if servers is None:
        rowspan = 1
    else:
        rowspan = (len(servers) or 1)+1
    print '<td><table width="100%" cellpadding=7><tr>'
    print '<td width="20%"',
    print 'bgcolor="%s" align="center" rowspan="%d">' % (bgcolor1, rowspan)
    print '<font size=+1 color="#FFFF00">'
    print '<strong>%s</strong>' % text
    print '</font></td>'
    print '<td bgcolor="%s">' % bgcolor2
    if servers is not None:
        if servers:
            show(servers[0])
        else:
            print "(no server found)"
        print '</td></tr>'
        for s in servers[1:]:
            print '<tr><td bgcolor="%s">' % bgcolor2
            show(s)
            print '</td></tr>'
        print '<tr><td bgcolor="%s">' % bgcolor2
    print '<form name="%s" action="%s" method="get">' % (tag, action)
    for key, value in hidden.items():
        print '<input type=hidden name="%s" value="%s">' % (key, value)
    print '<table border=0>'
    print '<tr>'
    print '<td width=48><img src="%s"></td>' % bubimg
    print '<td>'
    if tag=='L' and running and not found:
        print '<p><font size=-1>Note: your server does not appear in this list',
        import hostchooser, gamesrv
        if gamesrv.displaysockport(gamesrv.openpingsocket()) != hostchooser.UDP_PORT:
            print 'because the UDP port %d is already in use (is another Bub & Bob server running on this machine?);' % hostchooser.UDP_PORT
        else:
            print 'for an unknown reason;'
        print 'either register to the meta-server and use the Internet games list below, or use the full server address <strong>%s:%s</strong></font></p>' % running[0]
    print '<input type=submit value="%s"></td>' % btntext
    print '</tr>'
    print '</table>'
    print '</form>'
    return '</td></tr></table>'
)s


<tr>
<td width="6%%" bgcolor="#000000">&nbsp;</td>
<td bgcolor="#000000">&nbsp;</td>
<td width="6%%" bgcolor="#000000">&nbsp;</td>
</tr>

<tr>
<td bgcolor="#000000">&nbsp;</td>
<td bgcolor="#FFFFFF"><a href="stop.html"><img src="close.png" width=17 height=17>&nbsp;<font color="#FF0000" size=+1>Stop this program</font></a></td>
<td bgcolor="#000000">&nbsp;</td>
</tr>

<tr>
<td bgcolor="#000000">&nbsp;</td>
<td bgcolor="#F0E0E0">&nbsp;</td>
<td bgcolor="#000000">&nbsp;</td>
</tr>

<tr>
<td bgcolor="#000000">&nbsp;</td>
<td bgcolor="#E0C0C0" align="center"><font size=+3><strong>The Bub's Brothers</strong></font></td>
<td bgcolor="#000000">&nbsp;</td>
</tr>

<tr>
<td bgcolor="#000000">&nbsp;</td>
<td bgcolor="#F0E0E0">&nbsp;</td>
<td bgcolor="#000000">&nbsp;</td>
</tr>

<tr>
<td bgcolor="#000000">&nbsp;</td>
<td bgcolor="#FFFFFF">&nbsp;</td>
<td bgcolor="#000000">&nbsp;</td>
</tr>

<tr>
<td bgcolor="#000000">&nbsp;</td>
<td bgcolor="#FFFFFF" align="right">
  <a href="http://bub-n-bros.sourceforge.net"%(externaltarget)s>Web Home page</a> -
  <a href="name.html">Player Names &amp; Teams</a> -
  <a href="options.html">Display and sound settings</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</td>
<td bgcolor="#000000">&nbsp;</td>
</tr>

<tr>
<td bgcolor="#000000">&nbsp;</td>
<td bgcolor="#FFFFFF" background="wave1.png"><font size=+3>&nbsp;</font></td>
<td bgcolor="#000000">&nbsp;</td>
</tr>

<tr>
<td bgcolor="#000000">&nbsp;</td>
<td>
  <table width="100%%" cellpadding=7>
  <tr>
    <td width="20%%" bgcolor="#000080" align="center"><font size=+1 color="#FFFF00"><strong>New game</strong></font></td>
    <td bgcolor="#C0C0FF">
      <table border=0>
      <tr>
        <td width=48><img src="%(juststarted and 'sfbob.png' or 'bob.png')s"></td>
        <td>%(
if running:
    print '<form name="S" action="index.html" method="get">'
    print '<table width="100%" border=0><tr><td><p><strong>'
    if juststarted:
        print 'Server started!'
    elif count == 0:
        print 'No client is connected to your server at the moment.'
    elif count == 1:
        print 'One connected client.'
    else:
        print '%d connected clients.' % count
    print '</strong></p></td>'
    print '<td align="center"><input type=submit value="Update on connected clients"></td>'
    print '</tr></table></form>'
    print '<p><strong><a href="join.html?host=%s&port=%s&httpport=%s">' % (running[0][0], running[0][1], self.httpport),
    print 'Join your own game now</a></strong> at <strong>%s:%s</strong></p>' % (
        running[0])
if metapublish:
    import time
    print '<p><a href="register.html?a=%s">' % time.time()
    if self.globaloptions.metapublish == 'y':
        self.has_been_published = 1
        metaquery = metaquery or []
        metaquery.insert(0, 'desc='+fndesc)
        s = 'a=' + metapublish
        if s not in metaquery:
            metaquery.insert(0, s)
        print 'Register again',
    else:
        print 'Register (after all)',
    print 'your server to the SourceForge meta-server</a><br>'
    print '<a href="register.html?d=%s">' % time.time()
    print 'Unregister your server</a>',
    print '<font size=-1>(it is unregistered automatically after some time',
    print 'when other people cannot find it, or',
    print 'if you stop it with the link <font color="#FF2000">Stop this program</font> at the top of the page)</font></p>'
)s
<form name="n" action="new.html" method="get">
<input type=submit value="%(running and 'Start another game' or 'Start a new game')s">
</form>
        </td>
      </tr>
      </table>
    </td>
  </tr>
  </table>
</td>
<td bgcolor="#000000">&nbsp;</td>
</tr>

<tr>
<td bgcolor="#000000">&nbsp;</td>
<td bgcolor="#FFFFFF">&nbsp;</td>
<td bgcolor="#000000">&nbsp;</td>
</tr>

<tr>
<td bgcolor="#000000">&nbsp;</td>
<td bgcolor="#FFFFFF" background="wave3.png"><font size=+3>&nbsp;</font></td>
<td bgcolor="#000000">&nbsp;</td>
</tr>

<tr>
<td bgcolor="#000000">&nbsp;</td>
%(
localservers = self.getlocalservers()[:]
print showlist("L", "Local games", "#FF0080", "#FFC0C0", "boob.png", 
               localservers, "index.html", "Search again for local servers")
)s
<td bgcolor="#000000">&nbsp;</td>
</tr>

<tr>
<td bgcolor="#000000">&nbsp;</td>
<td bgcolor="#FFFFFF">&nbsp;</td>
<td bgcolor="#000000">&nbsp;</td>
</tr>

<tr>
<td bgcolor="#000000">&nbsp;</td>
<td bgcolor="#FFFFFF" background="wave2.png"><font size=+3>&nbsp;</font></td>
<td bgcolor="#000000">&nbsp;</td>
</tr>

<tr>
<td bgcolor="#000000"><a name=inet>&nbsp;</a></td>
%(
inetservers = self.getinetservers()
action = (inetservers is None) and "Download" or "Update"
if metaquery:
    query = metaquery + ['cmd=img']
    bubimg = metaserver + '?' + '&'.join(query)
else:
    bubimg = 'bub.png'
tail = showlist("G", "Internet games", "#008000", "#C0FFC0", bubimg,
         inetservers, metaserver, action + " current server list",
         cmd="list", frag="inet",
         url="http://%s/%s/list.html"%(myhost,self.seed))
)s
<p><font size=-1>%(inetservers is not None and 'Don\'t forget to <a href="name.html">give a name</a> to your dragons before you join a server!<br>The above list is limited to servers that could be contacted.' or '')s
You can also browse the <a href="%(metaserver)s"%(externaltarget)s>full server list on SourceForge</a>.</font></p>
%(tail)s
<td bgcolor="#000000">&nbsp;</td>
</tr>

<tr>
<td bgcolor="#000000">&nbsp;</td>
<td bgcolor="#000000" align="center"><img src="header.png"></td>
<td bgcolor="#000000">&nbsp;</td>
</tr>

<tr>
<td bgcolor="#000000">&nbsp;</td>
<td bgcolor="#000000">&nbsp;</td>
<td bgcolor="#000000">&nbsp;</td>
</tr>


</table></center>


</body>
</html>
